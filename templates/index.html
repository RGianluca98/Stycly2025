{% extends "base.html" %}
{% block title %}Stycly ‚Äì Noleggio abiti per bambini{% endblock %}

{% block content %}
<section class="stycly-hero">
  <div class="stycly-hero-content">
    <h1>Crea il tuo guardaroba digitale</h1>
    <strong>e scopri il noleggio abiti per bambini</strong>

    <p>
      Stycly √® il tuo guardaroba online di outfit per bambini pensato per shooting,
      eventi speciali e campagne creative.  
      Scegli i capi, prenota il noleggio e pensa solo alle foto.
    </p>

    <!-- CTA verso pagina prodotti -->
    <a href="{{ url_for('products') }}" class="stycly-cta-btn">
      Products
    </a>
  </div>
</section>

{% if featured_capi %}
<<section class="featured-section">
  <div class="featured-header">
    <h2>Featured Products</h2>
    <a href="{{ url_for('products') }}" class="view-all-link">View all</a>
  </div>

  <div class="featured-grid">
    {% for capo in featured %}
    <div class="product-card">
      
      <div class="card-img">
        <img 
          class="product-image"
          src="{{ url_for('immagini', filename=(capo['immagine'] or '').split('/')[-1]) }}"
          alt="Capo"
        >
        
        <div class="card-actions">
          <button class="action-btn add-to-cart" data-id="{{ capo['id'] }}">
            üõí
          </button>
          <button class="action-btn view-details" onclick="openFeaturedDetail({{ capo|tojson|safe }})">
            üîç
          </button>
        </div>
      </div>

      <div class="card-info">
        <h4>{{ capo.tipologia or "Item" }}</h4>
      </div>

    </div>
    {% endfor %}
  </div>
</section>

{% endif %}

<!-- QUICK VIEW MODAL stile template ecommerce -->
<div id="featured-detail-modal" class="quickview-overlay" style="display:none;">
  <div class="quickview-modal">
    <button class="quickview-close" id="quickview-close-btn" type="button">&times;</button>

    <div class="quickview-layout">
      <div class="quickview-image-wrap">
        <img id="quickview-image" src="" alt="Capo">
      </div>

      <div class="quickview-info">
        <h2 id="quickview-title" class="quickview-title"></h2>

        <p id="quickview-subtitle" class="quickview-subtitle"></p>

        <div id="quickview-description" class="quickview-description"></div>

        <ul class="quickview-meta">
          <li><strong>Taglia:</strong> <span id="quickview-taglia"></span></li>
          <li><strong>Colore:</strong> <span id="quickview-colore"></span></li>
          <li><strong>Brand:</strong> <span id="quickview-brand"></span></li>
          <li><strong>Destinazione:</strong> <span id="quickview-destinazione"></span></li>
          <li><strong>Fit:</strong> <span id="quickview-fit"></span></li>
          <li><strong>Disponibilit√†:</strong> <span id="quickview-dispo"></span></li>
        </ul>

        <!-- quantit√† + add to cart stile template -->
        <div class="quickview-actions">
          <div class="quickview-qty">
            <button type="button" id="quickview-minus" class="qty-btn">-</button>
            <span id="quickview-qty-value" class="qty-value">1</span>
            <button type="button" id="quickview-plus" class="qty-btn">+</button>
          </div>
          <button type="button" id="quickview-add-cart" class="quickview-add-btn">
            Add to cart
          </button>
        </div>

        <p class="quickview-categories">
          <strong>Categoria:</strong>
          <span id="quickview-categoria"></span>
        </p>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
// --- helper per immagini (stessa logica di public_wardrobe) ---
function buildImageURLHome(filename) {
  if (!filename) return "";
  const cleanName = filename.toString().split("/").pop();
  return "/immagini/" + cleanName;
}

let qvFront = "";
let qvBack  = "";
let qvQty   = 1;
let qvProduct = null;

function openFeaturedDetail(capo) {
  qvFront = capo.immagine;
  qvBack  = capo.immagine2 || "";
  qvQty   = 1;

  const title = (capo.categoria || '') + (capo.tipologia ? ' - ' + capo.tipologia : '');
  document.getElementById('quickview-title').textContent = title;

  document.getElementById('quickview-subtitle').textContent =
    capo.brand ? capo.brand : '';

  document.getElementById('quickview-description').textContent =
    capo.destinazione ? ('Perfetto per: ' + capo.destinazione) : '';

  document.getElementById('quickview-taglia').textContent       = capo.taglia || '-';
  document.getElementById('quickview-colore').textContent       = capo.colore || '-';
  document.getElementById('quickview-brand').textContent        = capo.brand || '-';
  document.getElementById('quickview-destinazione').textContent = capo.destinazione || '-';
  document.getElementById('quickview-fit').textContent          = capo.fit || '-';
  document.getElementById('quickview-dispo').textContent        = capo.disponibilita || 1;
  document.getElementById('quickview-categoria').textContent    = capo.categoria || '-';

  document.getElementById('quickview-image').src = buildImageURLHome(qvFront);
  document.getElementById('quickview-qty-value').textContent = qvQty;

  // oggetto prodotto per il carrello
  qvProduct = {
    id: capo.id,
    name: title,
    img: (capo.immagine || '').toString().split('/').pop()
  };

  document.getElementById('featured-detail-modal').style.display = 'flex';
}

function closeFeaturedDetail() {
  document.getElementById('featured-detail-modal').style.display = 'none';
}

function showFeaturedFront() {
  if (qvFront) {
    document.getElementById('quickview-image').src = buildImageURLHome(qvFront);
  }
}

function showFeaturedBack() {
  if (qvBack) {
    document.getElementById('quickview-image').src = buildImageURLHome(qvBack);
  }
}

document.addEventListener('DOMContentLoaded', () => {
  // apertura quick view
  document.querySelectorAll('.featured-info-btn').forEach(btn => {
    btn.addEventListener('click', function () {
      const capo = JSON.parse(this.getAttribute('data-capo'));
      openFeaturedDetail(capo);
    });
  });

  // chiusura quick view
  document.getElementById('quickview-close-btn').addEventListener('click', closeFeaturedDetail);
  document.getElementById('featured-detail-modal').addEventListener('click', (e) => {
    if (e.target.id === 'featured-detail-modal') {
      closeFeaturedDetail();
    }
  });

  // cambio fronte/retro cliccando sull'immagine
  document.getElementById('quickview-image').addEventListener('click', () => {
    // toggla fronte/retro se esiste
    if (!qvBack) return;
    const current = document.getElementById('quickview-image').getAttribute('src');
    const frontURL = buildImageURLHome(qvFront);
    const backURL  = buildImageURLHome(qvBack);
    document.getElementById('quickview-image').src =
      (current === frontURL) ? backURL : frontURL;
  });

  // gestione quantit√†
  document.getElementById('quickview-minus').addEventListener('click', () => {
    if (qvQty > 1) {
      qvQty--;
      document.getElementById('quickview-qty-value').textContent = qvQty;
    }
  });

  document.getElementById('quickview-plus').addEventListener('click', () => {
    qvQty++;
    document.getElementById('quickview-qty-value').textContent = qvQty;
  });

  // Add to cart dal popup
  document.getElementById('quickview-add-cart').addEventListener('click', () => {
    if (!qvProduct) return;
    if (typeof window.styclyAddToCart !== 'function') {
      alert('Carrello non disponibile al momento.');
      return;
    }

    for (let i = 0; i < qvQty; i++) {
      window.styclyAddToCart(qvProduct);
    }
    closeFeaturedDetail();
  });
});
</script>
{% endblock %}





