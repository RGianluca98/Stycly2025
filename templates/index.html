{% extends "base.html" %}
{% block title %}Stycly ? Noleggio abiti per bambini{% endblock %}

{% block content %}
<section class="stycly-hero hero-split">
  <div class="hero-bg-gradient"></div>
  <div class="stycly-hero-content">
    <div class="typewriter">
      <h1 class="typewriter-text">
        Noleggia outfit kids per shooting, eventi e set
      </h1>
    </div>

    <p class="hero-subtitle">
      Abiti selezionati 0-12 anni per foto, spot e cerimonie. Moodboard pronta, fitting facile,
      spedizione rapida: tu pensa solo allo shooting.
    </p>

    <div class="hero-highlights">
      <span>Look curati per bambini</span>
      <span>Noleggio breve e flessibile</span>
      <span>Selezione pronta per set</span>
    </div>

    <!-- CTA verso pagina prodotti -->
    <a href="{{ url_for('products') }}" class="stycly-cta-btn">
      Products
    </a>
  </div>
  <div class="hero-visual">
    <div class="hero-image" style="background-image: url('{{ url_for('immagini', filename='test.jpg') }}');"></div>
    <div class="hero-badge">Noleggio kids 0-12</div>
  </div>
</section>

<!-- Use cases con immagini di sfondo -->
<section class="stycly-usecases">
  <h2 class="section-heading">Scelti per ogni set</h2>
  <div class="usecase-grid">
    <article class="usecase-card" style="background-image: url('{{ url_for('immagini', filename='test.jpg') }}');">
      <div class="usecase-overlay">
        <h3>Shooting moda</h3>
        <p>Look editorial per neonati, kids e tween.</p>
      </div>
    </article>
    <article class="usecase-card" style="background-image: url('{{ url_for('immagini', filename='test.jpg') }}');">
      <div class="usecase-overlay">
        <h3>Eventi & red carpet</h3>
        <p>Outfit eleganti per serate e cerimonie.</p>
      </div>
    </article>
    <article class="usecase-card" style="background-image: url('{{ url_for('immagini', filename='test.jpg') }}');">
      <div class="usecase-overlay">
        <h3>Spot e adv</h3>
        <p>Capi versatili per spot TV, short e campagne.</p>
      </div>
    </article>
  </div>
</section>

<!-- Temi rapidi -->
<section class="stycly-themes">
  <div class="themes-header">
    <h2 class="section-heading">Moodboard rapide</h2>
    <p class="themes-sub">Scegli un tema e costruisci il set in pochi click.</p>
  </div>
  <div class="themes-grid">
    <div class="theme-card">
      <div class="theme-thumb" style="background-image: url('{{ url_for('immagini', filename='test.jpg') }}');"></div>
      <span>Boho soft</span>
    </div>
    <div class="theme-card">
      <div class="theme-thumb" style="background-image: url('{{ url_for('immagini', filename='test.jpg') }}');"></div>
      <span>Formal chic</span>
    </div>
    <div class="theme-card">
      <div class="theme-thumb" style="background-image: url('{{ url_for('immagini', filename='test.jpg') }}');"></div>
      <span>Color pop</span>
    </div>
    <div class="theme-card">
      <div class="theme-thumb" style="background-image: url('/static/img/theme-minimal.jpg');"></div>
      <span>Minimal cool</span>
    </div>
  </div>
</section>

<!-- Come funziona -->
<section class="stycly-how">
  <div class="how-bg"></div>
  <div class="how-card">
    <div class="how-head">
      <h2 class="section-heading">Come funziona il noleggio</h2>
      <p class="how-sub">Seguire il processo di noleggio su Stycly &egrave; semplice e veloce. Ecco tutti i passaggi:</p>
    </div>
    <div class="how-steps">
      <div class="how-step">
        <span class="how-number">1</span>
        <div>
          <h4>Cerca i prodotti</h4>
          <p>Naviga in Prodotti e scopri capi, accessori, props e oggetti per bambini.</p>
          <p>Filtra per categoria e guarda i dettagli di ogni articolo.</p>
        </div>
      </div>
      <div class="how-step">
        <span class="how-number">2</span>
        <div>
          <h4>Aggiungi al carrello</h4>
          <p>Scegli gli articoli e la quantit&aacute;; desiderata, poi aggiungili al carrello.</p>
        </div>
      </div>
      <div class="how-step">
        <span class="how-number">3</span>
        <div>
          <h4>Invia una richiesta di noleggio</h4>
          <p>Nel carrello clicca su Avanti e:</p>
          <ul class="how-bullets">
            <li>seleziona le date di noleggio dal calendario (uno o pi&uacute; giorni);</li>
            <li>inserisci i tuoi dati di contatto;</li>
            <li>conferma la richiesta.</li>
          </ul>
        </div>
      </div>
      <div class="how-step">
        <span class="how-number">4</span>
        <div>
          <h4>Ricevi il preventivo</h4>
          <p>Entro 24 ore ti contattiamo via email per confermare disponibilit&aacute; e inviarti il preventivo personalizzato.</p>
          <p>Completa ordine via email o telefono.</p>
        </div>
      </div>
      <div class="how-step">
        <span class="how-number">5</span>
        <div>
          <h4>Pagamento e fatturazione</h4>
          <p>Pagamento concordato con il nostro operatore (non online al momento) e ricezione della fattura.</p>
        </div>
      </div>
    </div>
  </div>
</section>

{% if featured_capi %}
<section class="stycly-featured">
  <div class="stycly-featured-header">
    <h2>Featured Products</h2>
    <a href="{{ url_for('products') }}" class="view-all-link">View all</a>
  </div>

  <div class="stycly-featured-grid">

    {% for capo in featured_capi %}
    <article class="stycly-featured-card">

      <!-- IMMAGINE QUADRATA CON OVERLAY -->
      <div class="stycly-featured-card-img">
        <img
          src="{{ url_for('immagini', filename=(capo['immagine'] or '').split('/')[-1]) }}"
          alt="{{ capo['tipologia'] or '' }}"
          draggable="false"
        >

        <!-- OVERLAY CON ANIMAZIONE TEMPLATE -->
        <div class="stycly-featured-card-overlay">

          <!-- ICONA CARRELLO -->
          <button type="button"
            class="icon-btn add-to-cart"
            data-id="{{ capo['id'] }}"
            data-name="{{ capo['categoria'] }} - {{ capo['tipologia'] }}"
            data-img="{{ (capo['immagine'] or '').split('/')[-1] }}"
            >
            <svg class="icon-20">
              <use xlink:href="#shopping-carriage"></use>
            </svg>
          </button>

          <!-- ICONA QUICK VIEW -->
          <button type="button"
            class="icon-btn featured-info-btn"
            data-capo='{{ capo|tojson|safe }}'>
            <svg class="icon-20">
              <use xlink:href="#quick-view"></use>
            </svg>
          </button>

        </div>
      </div>

      <!-- INFO SOTTO -->
      <div class="stycly-featured-card-body">
        <h3 class="card-title">
          {{ capo['categoria'] }} ? {{ capo['tipologia'] }}
        </h3>

        <p class="card-meta">
          Taglia: {{ capo['taglia'] or '-' }}
          {% if capo['colore'] %} · Colore: {{ capo['colore'] }}{% endif %}
          {% if capo['brand'] %} · Brand: {{ capo['brand'] }}{% endif %}
        </p>
      </div>

    </article>
    {% endfor %}

  </div>
</section>
{% endif %}


<!-- QUICK VIEW MODAL stile template ecommerce -->
<div id="featured-detail-modal" class="quickview-overlay" style="display:none;">
  <div class="quickview-modal">
    <button class="quickview-close" id="quickview-close-btn" type="button">&times;</button>

    <div class="quickview-layout">
      <div class="quickview-image-wrap">
        <img id="quickview-image" src="" alt="Capo">
      </div>

      <div class="quickview-info">
        <h2 id="quickview-title" class="quickview-title"></h2>

        <p id="quickview-subtitle" class="quickview-subtitle"></p>

        <div id="quickview-description" class="quickview-description"></div>

        <ul class="quickview-meta">
          <li><strong>Taglia:</strong> <span id="quickview-taglia"></span></li>
          <li><strong>Colore:</strong> <span id="quickview-colore"></span></li>
          <li><strong>Brand:</strong> <span id="quickview-brand"></span></li>
          <li><strong>Destinazione:</strong> <span id="quickview-destinazione"></span></li>
          <li><strong>Fit:</strong> <span id="quickview-fit"></span></li>
          <li><strong>Disponibilità:</strong> <span id="quickview-dispo"></span></li>
        </ul>

        <!-- quantità + add to cart stile template -->
        <div class="quickview-actions">
          <div class="quickview-qty">
            <button type="button" id="quickview-minus" class="qty-btn">-</button>
            <span id="quickview-qty-value" class="qty-value">1</span>
            <button type="button" id="quickview-plus" class="qty-btn">+</button>
          </div>
          <button type="button" id="quickview-add-cart" class="quickview-add-btn">
            Add to cart
          </button>
        </div>

        <p class="quickview-categories">
          <strong>Categoria:</strong>
          <span id="quickview-categoria"></span>
        </p>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
// --- helper per immagini (stessa logica di public_wardrobe) ---
function buildImageURLHome(filename) {
  if (!filename) return "";
  const cleanName = filename.toString().split("/").pop();
  return "/immagini/" + cleanName;
}

let qvFront = "";
let qvBack  = "";
let qvQty   = 1;
let qvProduct = null;

function openFeaturedDetail(capo) {
  qvFront = capo.immagine;
  qvBack  = capo.immagine2 || "";
  qvQty   = 1;

  const title = (capo.categoria || '') + (capo.tipologia ? ' - ' + capo.tipologia : '');
  document.getElementById('quickview-title').textContent = title;

  document.getElementById('quickview-subtitle').textContent =
    capo.brand ? capo.brand : '';

  document.getElementById('quickview-description').textContent =
    capo.destinazione ? ('Perfetto per: ' + capo.destinazione) : '';

  document.getElementById('quickview-taglia').textContent       = capo.taglia || '-';
  document.getElementById('quickview-colore').textContent       = capo.colore || '-';
  document.getElementById('quickview-brand').textContent        = capo.brand || '-';
  document.getElementById('quickview-destinazione').textContent = capo.destinazione || '-';
  document.getElementById('quickview-fit').textContent          = capo.fit || '-';
  document.getElementById('quickview-dispo').textContent        = capo.disponibilita || 1;
  document.getElementById('quickview-categoria').textContent    = capo.categoria || '-';

  document.getElementById('quickview-image').src = buildImageURLHome(qvFront);
  document.getElementById('quickview-qty-value').textContent = qvQty;

  // oggetto prodotto per il carrello
  qvProduct = {
    id: capo.id,
    name: title,
    img: (capo.immagine || '').toString().split('/').pop()
  };

  document.getElementById('featured-detail-modal').style.display = 'flex';
}

function closeFeaturedDetail() {
  document.getElementById('featured-detail-modal').style.display = 'none';
}

function showFeaturedFront() {
  if (qvFront) {
    document.getElementById('quickview-image').src = buildImageURLHome(qvFront);
  }
}

function showFeaturedBack() {
  if (qvBack) {
    document.getElementById('quickview-image').src = buildImageURLHome(qvBack);
  }
}

document.addEventListener('DOMContentLoaded', () => {
  // apertura quick view
  document.querySelectorAll('.featured-info-btn').forEach(btn => {
    btn.addEventListener('click', function () {
      const capo = JSON.parse(this.getAttribute('data-capo'));
      openFeaturedDetail(capo);
    });
  });

  // chiusura quick view
  document.getElementById('quickview-close-btn').addEventListener('click', closeFeaturedDetail);
  document.getElementById('featured-detail-modal').addEventListener('click', (e) => {
    if (e.target.id === 'featured-detail-modal') {
      closeFeaturedDetail();
    }
  });

  // cambio fronte/retro cliccando sull'immagine
  document.getElementById('quickview-image').addEventListener('click', () => {
    // toggla fronte/retro se esiste
    if (!qvBack) return;
    const current = document.getElementById('quickview-image').getAttribute('src');
    const frontURL = buildImageURLHome(qvFront);
    const backURL  = buildImageURLHome(qvBack);
    document.getElementById('quickview-image').src =
      (current === frontURL) ? backURL : frontURL;
  });

  // gestione quantità
  document.getElementById('quickview-minus').addEventListener('click', () => {
    if (qvQty > 1) {
      qvQty--;
      document.getElementById('quickview-qty-value').textContent = qvQty;
    }
  });

  document.getElementById('quickview-plus').addEventListener('click', () => {
    qvQty++;
    document.getElementById('quickview-qty-value').textContent = qvQty;
  });

  // Add to cart dal popup
  document.getElementById('quickview-add-cart').addEventListener('click', () => {
    if (!qvProduct) return;
    if (typeof window.styclyAddToCart !== 'function') {
      alert('Carrello non disponibile al momento.');
      return;
    }

    for (let i = 0; i < qvQty; i++) {
      window.styclyAddToCart(qvProduct);
    }
    closeFeaturedDetail();
  });
});





</script>
{% endblock %}





